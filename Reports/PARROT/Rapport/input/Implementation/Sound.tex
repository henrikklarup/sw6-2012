\section{Playing Sound}
\subsection*{Problem}
In our application we are making sentences by using pictograms. These pictograms consists of an image, as well as two optional sounds, as described in \autoref{appdes}, the reason for this being that it might help with communication and learning the concepts of what that pictogram illustrates.
For this to work, we need an elegant solution that will be easy to use.

\subsection*{Solution}
Writing the Pictogram class so that it includes functionality for playing its associated sound files has proven to be a good solution. Not only is it using only a few lines of code, it also makes using the functionality throughout the entire application very easy.

\subsection*{Execution}
To use the a sound of a pictogram, the application needs to include an audio player so that the sound can be played. Fortunately for the development team, the group who previously worked on the project have already written a functional audio player, which have been easily included in the PARROT application.\newline
In PARROT, the playing of sounds are handled in two different places in cooperation, the Pictogram class and the AudioPlayer class.\newline
The Pictogram class handles the data, and starts up the AudioPlayer wheneven it is needed.\newline

%Replace the with a code box instead?
\begin{source}{test}{}
	private void playItem(final String path) {
		// Running this in the background to keep UI responsive and smooth
		new Thread(new Runnable() {
			public void run() {
				try {
					AudioPlayer.play(path, null);
				} catch (Exception e) {
				}
			}
		}).start();
		//TODO check that the thread is stopped again at some point.
	}

	public void playSound()
	{
		if(soundPath!=null && validPath(soundPath))
		{
			playItem(soundPath);
		}
	}

	public void playWord()
	{
		if(wordPath!=null &&validPath(wordPath))
		{
			playItem(wordPath);
		}
	}
\end{source}

For instance, suppose we want to play the word of a pictogram (The word is a sound file with the pronunciation of the pictogram). 
The first thing we do is call the \textbf{playWord} method form the Pictogram in question. 
This method checks if the pictogram has a word, and if the path of that word corresponds to an existing sound file. 
If this is correct, it will call the \textbf{playItem} with its path as the input. 
The playItem then starts a new thread in which it makes the AudioPlayer play the corresponding sound. 
The reason for starting a new thread is that the user interface would become unresponsive while the sound was playing otherwise.\newline
The actual functionality that plays the sound is found the AudioPlayer class, more specifically the static \textbf{play} method.\newline

\begin{source}{}
	public static void play(String path, final OnCompletionListener listener)
	{
		AudioPlayer ap = getInstance();
		 
		try {
			ap.mMediaPlayer.reset();
			ap.mMediaPlayer.setDataSource(path);
			ap.mMediaPlayer.prepare();
			if (listener != null)
				ap.mMediaPlayer.setOnCompletionListener(listener);
			ap.mMediaPlayer.start(); 
		} catch (IllegalArgumentException e) {
			Log.e("sw6", "Media player throw exception, see stack trace");
			e.printStackTrace();
		} catch (IllegalStateException e) {
			Log.e("sw6", "Media player throw exception, see stack trace");
			e.printStackTrace();
		} catch (IOException e) {
			Log.e("sw6", "Media player throw exception, see stack trace");
			e.printStackTrace();
		} 
	}
\end{source}

What happens here is that the internal MediaPlayer object (A native android class) is reset, fed with data, and prepared for playing the sound. The MediaPlayer object is then started with the \textbf{start} method, which causes it to play the sound, If an error occurs, it will be caught, no sound will be played, and the error will be written to the log.\newline

\subsection*{Result}
The PARROT application can play sounds for its pictograms as long as they have associated sound files, will just ignore the request if a pictogram does not have any sound.

\subsection*{Notes:}
At the current state of the program, the only place in which the functionality for playing sound is being used, is in the \textbf{Tale} (Speech) tab. Here, the \textbf{playWord} method is triggered by clicking on a pictogram on the sentence board.\newline
Currently, the pictograms in the system only have a word-sound associated with them, rather than a sound effect. As such, a new idea will be needed instead of a simple click if both a sound and a word should be able to be played.

\subsection*{Further Reading:}
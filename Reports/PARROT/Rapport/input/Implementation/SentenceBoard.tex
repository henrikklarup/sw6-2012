\section{Sentence Board.} 
\subsection*{Problem:}
For kids with a hindrance in verbal communication, pictograms are utilized to help them communicate. 
In the digital version we need some kind of sentence board which have close to the same functionality such pictograms would have if they where used on a physical board. 
Meaning adding, removing and reorganize the pictograms in the sentence.

\subsection*{Solution:}
We generally use Drag and Drop for most of the functionality. 
We use it to add, delete and reorganize the sentence Board. 
We get the pictograms from categories that are shown in a gridview above the sentence board. 
We can drag pictograms from the gridview into the sentence board to add them. 
Likewise if we are to drag a pictogram out from the sentence board, it will be removed from the sentence board. 
By dragging a pictogram from the sentence board and release the pictogram in the sentence board, it will be shifted to the last position. 
Dragging a pictogram from the gridview and dropping it on top of a pictogram already in the sentence board, it will simply overwrite the old pictogram. 
To help this along we also fill the sentence board with ``empty'' picograms that are there to show that there currently are no pictogram at specific spaces.

\subsection*{Execution:}
We create a few long click listeners that utilize our BoxDragListener. 
These long click listeners are placed for the gridview we collect pictograms from, and the sentence board it self. 
These listeners are seen in Source Code \ref{sb1}.

%% get code from SpeechBoardFragment.java lines 96 - 106

\begin{source}[{sb1}]{skriv noget}
pictogramGrid.setOnItemLongClickListener(new OnItemLongClickListener()
			{

				public boolean onItemLongClick(AdapterView<?> arg0, View view, int position, long id)
				{
					draggedPictogramIndex = position; //TODO make sure that position is the index of the pictogram
					dragOwnerID = R.id.pictogramgrid;
					ClipData data = ClipData.newPlainText("label", "text"); //TODO Dummy. Pictogram information can be placed here instead.
					DragShadowBuilder shadowBuilder = new DragShadowBuilder(view);
					view.startDrag(data, shadowBuilder, view, 0);
					return true;
				}
\end{source}

Here we also draw the shadow so that the user see that they are dragging a pictogram.
The rest of the functionality are in the BoxDragListener. See \autoref{dnd}.

When we know that a pictogram is from outside the sentence board and is dropped into the sentence board we know that we are to add the pictogram to the sentence. At the moment this only occurs when the pictogram are dragged from the gridview.
If the pictogram is dropped on top of an already existing pictogram in the sentence board, it will overwrite the pictogram on the sentence board. If it is dropped anywhere else in the sentence board it will add itself to the last entry of the sentence.
In this situation we need to know where the pictogram are dropped. 
We do this by getting the position of the drop, and then what index the object at this position in the sentence board have. 
This can be seen in Source Code \ref{sb2}.

%% get code from BoxDragListener lined 54 - 59
\begin{source}[{sb2}]{skriv noget}
if( self.getId() == R.id.sentenceboard && SpeechBoardFragment.dragOwnerID != R.id.sentenceboard)	//We are about to drop a view into the sentenceboard
				{
					GridView speech = (GridView) parrent.findViewById(R.id.sentenceboard);
					int x = (int)event.getX();
					int y = (int)event.getY();
					int index = speech.pointToPosition(x, y);
\end{source}
We then check if there already is a pictogram in the given place. We can do this by checking if the current pictogram are the ``empty'' pictogram. If it is not we know there already are a pictogram and we replace it.
This is seen in Source Code \ref{sb3}.

%% get code from BoxDragListener lines 71 - 75
\begin{source}[{sb3}]{skriv noget}
if(SpeechBoardFragment.speechBoardCategory.getPictogramAtIndex(index).isEmpty() == false) //Replaces a pictogram already in the sentencebord
						{
							SpeechBoardFragment.speechBoardCategory.removePictogram(index); //Removes the pictogram at the specific index
							SpeechBoardFragment.speechBoardCategory.addPictogramAtIndex(draggedPictogram, index); //add the pictogram at the specific position
						}
\end{source}
If it is the ``empty'' pictogram it will try to place the pictogram furthes to the left of the sentence. 
We do this with a while loop that runs for the duration of spaces in the sentence board. We start at the leftmost entry in the sentence board if its empty, and continue to the right. 
When an empty place is found, the pictogram are placed here and the loop breaks.
This is shown in Source Code \ref{sb4}.

%% get code from BoxDragListener.java lines 78 - 90
\begin{source}[{sb4}]{skriv noget}
else 
	{
	int count = 0;
	while (count < numberOfSentencePictograms) 
		{

		if (SpeechBoardFragment.speechBoardCategory.getPictogramAtIndex(count).isEmpty() == true) 
			{
			SpeechBoardFragment.speechBoardCategory.removePictogram(count); //Removes the pictogram at the specific index
			SpeechBoardFragment.speechBoardCategory.addPictogramAtIndex(draggedPictogram, count); //add the pictogram at the specific position
			break;
			} 
			count++;
		}
	}
\end{source}
When we know that a pictogram are from the sentence board and are dropped into the sentence board it is because we are about to rearrange the pictograms in the sentence board. We use the same method as we did when we where about to drag something from the gridview into the sentence board. 

When we know that a pictogram is from the sentence board and dropped somewhere else we simply remove it from the sentence board. This is already done in the DRAG\_STARTED action. Whenever a pictogram are beign dragged from the sentence board it is removed from it. It can the be placed again via the DROP action. If this happens outside the sentence board though it is simply removed. 
This method removes the pictogram and shift all pictograms that are to the right one to the left so that no spaces are left in the sentence. 
The deletion of a pictogram are seen in Source Code \ref{sb5}.

% get code from BoxDragListener.java lines 29- 45
\begin{source}[{sb5}]{skriv noget}
if (event.getAction() == DragEvent.ACTION_DRAG_STARTED){
			if(self.getId() == R.id.sentenceboard && SpeechBoardFragment.dragOwnerID == R.id.sentenceboard)
			{
				draggedPictogram = SpeechBoardFragment.speechBoardCategory.getPictogramAtIndex(SpeechBoardFragment.draggedPictogramIndex);
				if(draggedPictogram.isEmpty()==true)
				{
					//Do not allow dragging empty pictograms
				}
				else
				{
					GridView speech = (GridView) parrent.findViewById(R.id.sentenceboard);
					SpeechBoardFragment.speechBoardCategory.removePictogram(SpeechBoardFragment.draggedPictogramIndex);	
					SpeechBoardFragment.speechBoardCategory.addPictogram(new Pictogram("#usynlig#", null, null, null, parrent));
					speech.setAdapter(new PictogramAdapter(SpeechBoardFragment.speechBoardCategory, parrent));
				}
			}
\end{source}

\subsection*{Result:}
We can now add and remove pictograms from the sentence board. We can replace pictograms already on the board. The pictograms will always be shifted so that there are no spaces between picograms. It is possible to rearrange the pictograms.


\subsection*{Notes:}
It should be noted that we have chosen that the pictograms shift to the left whenever they can. This is a design choice that can be changed if further study shows it to be favorable to do otherwise. 
In the same way have we made the choice that pictograms are to be overwritten. Another alternative would be to shift all pictograms to make room for the new pictogram. This is also something that can be changed if further study shows that it is necessary.


\subsection*{Further Reading:}
These functionalities are closely bound to the Drag And Drop functionality REFFER TO DRAG AND DROP.